knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
reef <- read.csv("Coral_Data_for_MINISTRY_OF_MARINE_AFFAIRS_AND_FISHERIES_REPUBLIC_OF_INDONESIA_-_Global_Coral_Reef_Monitoring_Network__GCRMN_.csv")
fish <- read.csv("Fish_Data_for_MINISTRY_OF_MARINE_AFFAIRS_AND_FISHERIES_REPUBLIC_OF_INDONESIA_-_Global_Coral_Reef_Monitoring_Network__GCRMN_.csv")
reef
fish
shiny::runApp()
runApp()
runApp()
runApp()
knitr::opts_chunk$set(echo = TRUE)
fish_data <- data.frame(Labridae = numeric(),
Scaridae = numeric(),
Siganidae = numeric(),
Haemulidae = numeric(),
Lutjanidae = numeric(),
Serranidae = numeric(),
Acanthuridae = numeric(),
Caesioinidae = numeric(),
Nemipteridae = numeric(),
Sphyraenidae = numeric(),
Monacanthidae = numeric(),
Pomacentridae = numeric(),
Chaetodontidae = numeric(),
Tetraodontidae = numeric(),
stringsAsFactors = FALSE)
fish_data <- data.frame(Labridae = numeric(),
Scaridae = numeric(),
Siganidae = numeric(),
Haemulidae = numeric(),
Lutjanidae = numeric(),
Serranidae = numeric(),
Acanthuridae = numeric(),
Caesioinidae = numeric(),
Nemipteridae = numeric(),
Sphyraenidae = numeric(),
Monacanthidae = numeric(),
Pomacentridae = numeric(),
Chaetodontidae = numeric(),
Tetraodontidae = numeric(),
stringsAsFactors = FALSE)
library(tidyr)
df <- separate(data = all_fish_data, col = biomass_kgha_by_fish_family_avg, into = c("Labridae", "Mullidae", "Scaridae", "Siganidae", "Apogonidae", "Balistidae", "Blenniidae", "Lutjanidae", "Serranidae", "Cirrhitidae", "Lethrinidae", "Ostraciidae", "Acanthuridae", "Aulostomidae", "Caesioinidae", "Nemipteridae", "Microdesmidae", "Monacanthidae", "Pinguipedidae", "Pomacanthidae", "Pomacentridae", "Chaetodontidae", "Tetraodontidae", "Pseudochromidae", "Pholidichthyidae"), sep = ", ", convert = TRUE, remove = TRUE)
library(readr)
library(dplyr)
fish2015 <- read_csv("DataFromGeodie/2015 fishbiomass.csv")
reef2015 <- read_csv("DataFromGeodie/2015benthicdata.csv")
reef2016 <- read_csv("DataFromGeodie/karimunjawa2016benthicdata.csv")
fish2016 <- read_csv("DataFromGeodie/karimunjawa2016fishbiomass.csv")
reef2018 <- read_csv("DataFromGeodie/liang_ngali_mpa_2018fishbiomass.csv")
reef2019 <- read_csv("DataFromGeodie/karimunjawa2019benthicdata.csv")
fish2019 <- read_csv("DataFromGeodie/karimunjawa2019fishbiomass.csv")
reef2021 <- read_csv("DataFromGeodie/SE Sulawesi2021benthicdata.csv")
selecColoumn <- c("site_name","latitude","longitude", "sample_date_year", "sample_date_month", "sample_date_day", "reef_exposure", "reef_type", "reef_zone", "depth_avg", "percent_cover_by_benthic_category_avg")
reef2015<- reef2015 %>% select(selecColoumn)
selecColoumn<- c("site_name","latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "biomass_kgha_by_fish_family_avg")
fish2015<- fish2015 %>% select(selecColoumn)
selecColoumn <- c("site_name", "latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "reef_exposure", "reef_type", "reef_zone", "depth_avg", "percent_cover_by_benthic_category_avg")
reef2016<- reef2016 %>% select(selecColoumn)
selecColoumn<- c("site_name","latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "biomass_kgha_by_fish_family_avg")
fish2016<- fish2016 %>% select(selecColoumn)
selecColoumn<- c("site_name","latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "biomass_kgha_by_fish_family_avg")
reef2018<- reef2018 %>% select(selecColoumn)
selecColoumn <- c("site_name","latitude","longitude", "sample_date_year", "sample_date_month", "sample_date_day", "reef_exposure", "reef_type", "reef_zone", "depth_avg", "percent_cover_by_benthic_category_avg")
reef2019<- reef2019 %>% select(selecColoumn)
selecColoumn<- c("site_name","latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "biomass_kgha_by_fish_family_avg")
fish2019<- fish2019 %>% select(selecColoumn)
selecColoumn <- c("site_name", "latitude","longitude","sample_date_year", "sample_date_month", "sample_date_day", "reef_exposure", "reef_type", "reef_zone", "depth_avg", "percent_cover_by_benthic_category_avg")
reef2021 <- reef2021 %>% select(selecColoumn)
reef2015
reef2016
reef2019
reef2021
library(readr)
library(dplyr)
# 合并所有reef数据集
all_reef_data <- rbind(reef2015, reef2016, reef2019, reef2021)
# 合并所有fish数据集
all_fish_data <- rbind(fish2015, fish2016, fish2019)
# 将合并后的数据集保存为CSV文件
write_csv(all_reef_data, "all_reef_data.csv")
write_csv(all_fish_data, "all_fish_data.csv")
library(tidyr)
df <- separate(data = all_fish_data, col = biomass_kgha_by_fish_family_avg, into = c("Labridae", "Mullidae", "Scaridae", "Siganidae", "Apogonidae", "Balistidae", "Blenniidae", "Lutjanidae", "Serranidae", "Cirrhitidae", "Lethrinidae", "Ostraciidae", "Acanthuridae", "Aulostomidae", "Caesioinidae", "Nemipteridae", "Microdesmidae", "Monacanthidae", "Pinguipedidae", "Pomacanthidae", "Pomacentridae", "Chaetodontidae", "Tetraodontidae", "Pseudochromidae", "Pholidichthyidae"), sep = ", ", convert = TRUE, remove = TRUE)
library(tidyr)
df <- separate(data = all_fish_data, col = biomass_kgha_by_fish_family_avg, into = c("Labridae", "Mullidae", "Scaridae", "Siganidae", "Apogonidae", "Balistidae", "Blenniidae", "Lutjanidae", "Serranidae", "Cirrhitidae", "Lethrinidae", "Ostraciidae", "Acanthuridae", "Aulostomidae", "Caesioinidae", "Nemipteridae", "Microdesmidae", "Monacanthidae", "Pinguipedidae", "Pomacanthidae", "Pomacentridae", "Chaetodontidae", "Tetraodontidae", "Pseudochromidae", "Pholidichthyidae"), sep = ", ", convert = TRUE, remove = TRUE)
df$biomass_total <- rowSums(df[, c("Labridae", "Mullidae", "Scaridae", "Siganidae", "Apogonidae", "Balistidae", "Blenniidae", "Lutjanidae", "Serranidae", "Cirrhitidae", "Lethrinidae", "Ostraciidae", "Acanthuridae", "Aulostomidae", "Caesioinidae", "Nemipteridae", "Microdesmidae", "Monacanthidae", "Pinguipedidae", "Pomacanthidae", "Pomacentridae", "Chaetodontidae", "Tetraodontidae", "Pseudochromidae", "Pholidichthyidae"]])
library(tidyverse)
library(jsonlite)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 定义一个函数，将json字符串转换成列表
to_list <- function(x) {
fromJSON(gsub("'", '"', x), simplifyVector = FALSE)
}
# 拆分biomass_kgha_by_fish_family_avg列，每个种类一列
df_split <- df %>%
mutate(biomass_kgha_by_fish_family_avg = lapply(biomass_kgha_by_fish_family_avg, to_list)) %>%
unnest_wider(biomass_kgha_by_fish_family_avg, names_sep = "_")
# 输出结果
df_split
library(tidyverse)
library(jsonlite)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 将单引号替换成双引号
data$biomass_kgha_by_fish_family_avg <- gsub("'", "\"", data$biomass_kgha_by_fish_family_avg)
library(tidyverse)
library(jsonlite)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 定义一个函数，将json字符串转换成列表
to_list <- function(x) {
fromJSON(gsub("'", '"', x), simplifyVector = FALSE)
}
# 拆分biomass_kgha_by_fish_family_avg列，每个种类一列
df_split <- df %>%
mutate(biomass_kgha_by_fish_family_avg = lapply(biomass_kgha_by_fish_family_avg, to_list)) %>%
unnest_wider(biomass_kgha_by_fish_family_avg, names_sep = "_")
# 输出结果
df_split
library(jsonlite)
# 读入数据
data <- read.csv("all_fish_data.csv")
# 将单引号替换成双引号
data$biomass_kgha_by_fish_family_avg <- gsub("'", "\"", data$biomass_kgha_by_fish_family_avg)
# 将 JSON 字符串转换成列表
data$biomass_kgha_by_fish_family_avg <- lapply(data$biomass_kgha_by_fish_family_avg, fromJSON)
# 将每个种类作为新列名
species_names <- unique(unlist(lapply(data$biomass_kgha_by_fish_family_avg, names)))
for (name in species_names) {
data[[name]] <- sapply(data$biomass_kgha_by_fish_family_avg, function(x) x[[name]])
}
# 替换列名
colnames(data) <- species_names
# 移除原来的列
data$biomass_kgha_by_fish_family_avg <- NULL
library(jsonlite)
# 读入数据
data <- read.csv("all_fish_data.csv")
# 将单引号替换成双引号
data$biomass_kgha_by_fish_family_avg <- gsub("'", "\"", data$biomass_kgha_by_fish_family_avg)
# 将 JSON 字符串转换成列表
data$biomass_kgha_by_fish_family_avg <- lapply(data$biomass_kgha_by_fish_family_avg, fromJSON)
# 将每个种类作为新列名
species_names <- unique(unlist(lapply(data$biomass_kgha_by_fish_family_avg, names)))
for (name in species_names) {
data[[name]] <- sapply(data$biomass_kgha_by_fish_family_avg, function(x) x[[name]])
}
# 替换列名
colnames(data) <- species_names
# 移除原来的列
data$biomass_kgha_by_fish_family_avg <- NULL
data
library(tidyverse)
library(jsonlite)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 定义一个函数，将json字符串转换成列表
to_list <- function(x) {
fromJSON(gsub("'", '"', x), simplifyVector = FALSE)
}
# 拆分biomass_kgha_by_fish_family_avg列，每个种类一列
df_split <- df %>%
mutate(biomass_kgha_by_fish_family_avg = lapply(biomass_kgha_by_fish_family_avg, to_list)) %>%
unnest_wider(biomass_kgha_by_fish_family_avg, names_sep = "_")
# 输出结果
df_split
library(tidyverse)
library(jsonlite)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 定义一个函数，将json字符串转换成列表
to_list <- function(x) {
fromJSON(gsub("'", '"', x), simplifyVector = FALSE)
}
# 拆分biomass_kgha_by_fish_family_avg列，每个种类一列
df_split <- df %>%
mutate(biomass_kgha_by_fish_family_avg = lapply(biomass_kgha_by_fish_family_avg, to_list)) %>%
unnest_wider(biomass_kgha_by_fish_family_avg, names_sep = "_")
# 输出结果
write.csv(df_split, "all_fish_data.csv", row.names = FALSE)
library(tidyverse)
# 读取数据
df <- read_csv("all_fish_data.csv")
# 定义一个函数，将json字符串转换成列表
to_list <- function(x) {
fromJSON(gsub("'", '"', x), simplifyVector = FALSE)
}
# 拆分biomass_kgha_by_fish_family_avg列，每个种类一列
df_split <- df %>%
mutate(biomass_kgha_by_fish_family_avg = lapply(biomass_kgha_by_fish_family_avg, to_list)) %>%
unnest_wider(biomass_kgha_by_fish_family_avg, names_sep = "_") %>%
# 将缺失值替换成0
replace_na(list(Labridae = 0, Mullidae = 0, Scaridae = 0, Siganidae = 0, Apogonidae = 0, Balistidae = 0,
Blenniidae = 0, Lutjanidae = 0, Serranidae = 0, Cirrhitidae = 0, Lethrinidae = 0, Acanthuridae = 0,
Caesioinidae = 0, Nemipteridae = 0, Monacanthidae = 0, Pomacanthidae = 0, Pomacentridae = 0,
Chaetodontidae = 0, Tetraodontidae = 0, Zanclidae = 0, Ostraciidae = 0, Aulostomidae = 0,
Microdesmidae = 0, Pseudochromidae = 0, Carangidae = 0, Holocentridae = 0, Pholidichthyidae = 0,
Synodontidae = 0, Pinguipedidae = 0, Haemulidae = 0, Kyphosidae = 0, Scombridae = 0,
Sphyraenidae = 0, Scorpaenidae = 0, Dasyatidae = 0, Diodontidae = 0, Fistulariidae = 0,
Gobiidae = 0, Belonidae = 0, Muraenidae = 0, Ephippidae = 0, Syngnathidae = 0,
Plotosidae = 0, Priacanthidae = 0, Centriscidae = 0, Pempheridae = 0, Malacanthidae = 0,
Echeneidae = 0, Carcharhinidae = 0))
# 读取数据
data <- read_csv("all_fish_data.csv")
library(ggplot2)
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Labridae)) +
geom_line(color = "blue") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
# 读取数据
data <- read_csv("all_fish_data.csv")
library(ggplot2)
# 选择需要绘制的列，除了经纬度和日期列
fish_cols <- names(data)[-c(1:3, 4:6)]
# 转换日期列为日期格式
data$sample_date <- as.Date(paste(data$sample_date_year, data$sample_date_month, data$sample_date_day, sep = "-"))
# 将每种鱼的生物量转换为向量
fish_data <- lapply(data[fish_cols], as.numeric)
# 创建数据框
fish_data_df <- data.frame(site_name = rep(data$site_name, times = length(fish_cols)),
fish_type = rep(fish_cols, each = nrow(data)),
biomass = unlist(fish_data),
date = rep(data$sample_date, times = length(fish_cols)))
# 绘制折线图
ggplot(fish_data_df, aes(x = date, y = biomass, color = fish_type)) +
geom_line() +
facet_wrap(~site_name, ncol = 3) +
labs(x = "日期", y = "平均生物量", color = "鱼种类") +
theme_bw()
# 读取数据
data <- read_csv("all_fish_data.csv")
library(ggplot2)
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Labridae)) +
geom_line(color = "blue") +
ggtitle("Biomass kgha by Labridae over years") +
xlab("Year") +
ylab("Biomass kgha by Labridae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Mullidae)) +
geom_line(color = "red") +
ggtitle("Biomass kgha by Mullidae over years") +
xlab("Year") +
ylab("Biomass kgha by Mullidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Scaridae)) +
geom_line(color = "green") +
ggtitle("Biomass kgha by Scaridae over years") +
xlab("Year") +
ylab("Biomass kgha by Scaridae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Siganidae)) +
geom_line(color = "purple") +
ggtitle("Biomass kgha by Siganidae over years") +
xlab("Year") +
ylab("Biomass kgha by Siganidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Apogonidae)) +
geom_line(color = "orange") +
ggtitle("Biomass kgha by Apogonidae over years") +
xlab("Year") +
ylab("Biomass kgha by Apogonidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Balistidae)) +
geom_line(color = "brown") +
ggtitle("Biomass kgha by Balistidae over years") +
xlab("Year") +
ylab("Biomass kgha by Balistidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Blenniidae)) +
geom_line(color = "gray") +
ggtitle("Biomass kgha by Blenniidae over years") +
xlab("Year") +
ylab("Biomass kgha by Blenniidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Lutjanidae)) +
geom_line(color = "pink") +
ggtitle("Biomass kgha by Lutjanidae over years") +
xlab("Year") +
ylab("Biomass kgha by Lutjanidae")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Cirrhitidae)) +
geom_line(color = "green") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Lethrinidae)) +
geom_line(color = "orange") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Acanthuridae)) +
geom_line(color = "purple") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Caesioinidae)) +
geom_line(color = "red") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Nemipteridae)) +
geom_line(color = "brown") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Monacanthidae)) +
geom_line(color = "grey") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Pomacanthidae)) +
geom_line(color = "navy") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Pomacentridae)) +
geom_line(color = "magenta") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
ggplot(data, aes(x = sample_date_year, y = biomass_kgha_by_fish_family_avg_Chaetodontidae)) +
geom_line(color = "coral") +
ggtitle("Biomass kgha by fish family avg over years") +
xlab("Year") +
ylab("Biomass kgha by fish family avg")
runApp()
runApp()
runApp()
runApp()
