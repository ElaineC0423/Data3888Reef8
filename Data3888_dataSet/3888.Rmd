---
title: '3888'
author: '500033689'
date: "2023-03-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
reef <- read.csv("Reef_Check_with_cortad_variables_with_annual_rate_of_SST_change.csv")

southeast_asia_countries <- c(
  "Indonesia",
  "Thailand",
  "Malaysia",
  "Singapore",
  "Philippines",
  "Vietnam",
  "Brunei",
  "Myanmar (Burma)",
  "Cambodia",
  "Laos",
  "Timor-Leste"
)

reef_data <- subset(reef, Ocean == "Pacific" & Country %in% southeast_asia_countries)


print(colnames(reef))


# 筛选Indonesia的数据
reef_data_indonesia <- subset(reef_data, Country == "Indonesia")

# 根据需要的变量创建折线图，例如以年份为x轴
# 假设你的数据集中有一个名为"Year"的列，表示年份
library(ggplot2)
ggplot(data = reef_data_indonesia, aes(x = Year, y = Average_bleaching)) +
  geom_line() +
  labs(x = "Year", y = "Average Bleaching") +
  ggtitle("Indonesia Average Bleaching")

```
```{r}
selected_columns <- subset(reef_data, select = c("Reef.ID", "Reef.Name", "SSTA", "SSTA_DHW", "Average_bleaching"))
print(selected_columns)
```

```{r}
library(MASS)
# Calculate correlation coefficients
# Remove the "SSTA_Mean" variable
# 先从完整模型开始
full_model <- lm(Average_bleaching ~ ClimSST + Temperature_Kelvin + Temperature_Mean +
                   Temperature_Minimum + Temperature_Maximum + Temperature_Kelvin_Standard_Deviation + Windspeed +
                   SSTA + SSTA_Standard_Deviation + SSTA_Minimum + SSTA_Maximum + SSTA_Frequency +
                   SSTA_Frequency_Standard_Deviation + SSTA_FrequencyMax + SSTA_FrequencyMean + SSTA_DHW + SSTA_DHW_Standard_Deviation +
                   SSTA_DHWMax + SSTA_DHWMean + TSA + TSA_Standard_Deviation + TSA_Minimum + TSA_Maximum + TSA_Mean + TSA_Frequency +
                   TSA_Frequency_Standard_Deviation + TSA_FrequencyMax + TSA_FrequencyMean + TSA_DHW + TSA_DHW_Standard_Deviation +
                   TSA_DHWMax + TSA_DHWMean, data = reef_data_clean)

# 使用 stepAIC 函数进行逐步回归
step_model <- stepAIC(full_model, direction = "both")
summary(step_model)







```


TSA_DHW (p-value: < 2e-16)
TSA_DHWMax (p-value: 2.83e-13)
TSA_DHW_Standard_Deviation (p-value: 1.03e-11)
SSTA_Frequency_Standard_Deviation (p-value: 1.93e-08)
Windspeed (p-value: 5.89e-08)


```{r}
# Subset the data with only SSTA and Average_bleaching
reef_data_ssta <- reef_data_clean[, c("SSTA", "Average_bleaching")]

# Remove rows with missing values
reef_data_ssta <- na.omit(reef_data_ssta)

# Train linear regression model
lm_model <- lm(Average_bleaching ~ SSTA, data = reef_data_ssta)

# Print summary of the model
summary(lm_model)

```
```{r}
library(ggplot2)
ggplot(data = reef_data_clean, aes(x = SSTA, y = Average_bleaching)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm") +
  labs(x = "SSTA", y = "Average Bleaching")

```
```{r}
ggplot(data = reef_data_clean, aes(x = TSA_DHW, y = Average_bleaching)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm") +
  labs(x = "TSA_DHW", y = "Average Bleaching")


```
```{r}
reef_data_filtered <- subset(reef_data_clean, Average_bleaching > 0)

# 使用ggplot绘制散点图
library(ggplot2)
ggplot(data = reef_data_filtered, aes(x = TSA_DHW, y = Average_bleaching)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm") +
  labs(x = "TSA_DHW", y = "Average Bleaching")
```

```{r}
# 筛选coral bleaching大于0的数据
reef_data_filtered <- subset(reef_data_clean, Average_bleaching > 0)

# 计算平均DHW
average_dhw <- mean(reef_data_filtered$TSA_DHW)

# 输出结果
average_dhw
```



```{r}
library(class)

# Subset the data with only SSTA and Average_bleaching
reef_data_ssta <- reef_data_clean[, c("SSTA", "Average_bleaching")]

# Remove rows with missing values
reef_data_ssta <- na.omit(reef_data_ssta)

# Set the seed for reproducibility
set.seed(123)

# Split the data into training and testing sets
sample_size <- floor(0.8 * nrow(reef_data_ssta))
train_indices <- sample(seq_len(nrow(reef_data_ssta)), size = sample_size)

train_data <- reef_data_ssta[train_indices, ]
test_data <- reef_data_ssta[-train_indices, ]

# Separate the predictors and response variables
train_x <- train_data[, "SSTA", drop = FALSE]
train_y <- train_data[, "Average_bleaching"]
test_x <- test_data[, "SSTA", drop = FALSE]
test_y <- test_data[, "Average_bleaching"]

# Train the k-NN model
k <- 3 # You can change this value to optimize the model
knn_model <- knn(train_x, test_x, train_y, k = k)

# Evaluate the model (e.g., using accuracy)
accuracy <- mean(test_y == knn_model)
print(paste("Accuracy:", accuracy))

```
```{r}
library(caret)

# Subset the data with only SSTA and Average_bleaching
reef_data_ssta <- reef_data_clean[, c("SSTA", "Average_bleaching")]

# Remove rows with missing values
reef_data_ssta <- na.omit(reef_data_ssta)

# Set the seed for reproducibility
set.seed(123)

# Define 10-fold cross-validation
cv_control <- trainControl(method = "cv", number = 10)

# Train the k-NN model with 10-fold cross-validation
k <- 3 # You can change this value to optimize the model
knn_model_cv <- train(Average_bleaching ~ SSTA, data = reef_data_ssta, method = "knn", trControl = cv_control, tuneGrid = data.frame(k = k))

# Evaluate the model performance using cross-validation results
print(knn_model_cv)
```




```{r}

# 加载所需的库
library(dplyr)
library(jsonlite)
library(httr)

# 从API获取数据
res_species = GET("http://openfisheries.org/api/landings/species.json")
species_data = fromJSON(rawToChar(res_species$content))

# 转换为数据框并重命名列
species_df <- data.frame(species_data$scientific_name, species_data$a3_code) %>%
  rename(
    a3_code = species_data.a3_code,
    scientific_name = species_data.scientific_name
  )

species_df 

# 筛选国家代码为"IDN"的数据
idn_species_df <- species_df %>%
  filter(a3_code == "IDN")



# 输出筛选后的数据
print(idn_species_df)


```



